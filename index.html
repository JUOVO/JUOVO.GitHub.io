

<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">
<head><meta http-equiv="X-UA-Compatible" content="IE=11; IE=10; IE=9; IE=8" /><meta http-equiv="Content-Type" content="text/html; charset=utf-8" /><link href="../../../style/bootstrap.min.css" rel="stylesheet" /><link href="../../../style/font-awesome.min.css" rel="stylesheet" /><link href="../../../style/fontCrm.css" rel="stylesheet" /><link href="../../../style/base.css" rel="stylesheet" /><link href="../../../style/style.css" rel="stylesheet" /><title>
	首页-业务洞察
</title>
    <style>
        .demo-table {
            width: 100%;
        }

            .demo-table th {
                color: #118EF6;
                text-align: center;
                background: #deeffd;
                padding: 10px;
                color: #35A4F7;
            }

            .demo-table td {
                padding: 10px;
                border-bottom: dashed 1px #efefef;
                text-align: center;
            }

            .demo-table .bdNone td {
                border-bottom-color: transparent;
            }

        .demo-data {
            border-right: dashed 1px #EDECF2;
            padding: 17px 10px;
        }

            .demo-data span {
                color: #35A4F7;
                font-size: 24px;
                margin-right: 3px;
            }

            .demo-data > div:nth-child(2) {
                margin-top: 5px;
                font-size: 14px;
            }
    </style>
</head>
<body class="main-bg">
    <form method="post" action="./home.aspx" id="form1">
<div class="aspNetHidden">
<input type="hidden" name="__VIEWSTATE" id="__VIEWSTATE" value="/wEPDwUKMTc0MTI1MTQzM2RkZJf4phlCs5ZKXHj76dr+n/Co6kk=" />
</div>

<script language="javascript" id="Hxj_Web_UI_Script_jquery-1_8_0_js" type="text/javascript" src="/WebResource.axd?d=ljbvqvxJUbwTntm5VbTyzwkpxMKTCuG1aan6KkOwhLh8oZEHBeQawl1c60DxRtEjg_XardPL9yG-lCb-xwDRnFmVJQcrJL0UD9gJ325JM2fmDY9-wMl9RTYbOY41&t=636899960260000000"></script><script language="javascript" id="Hxj_Web_UI_Script_jquery_json-2_4_js" type="text/javascript" src="/WebResource.axd?d=lzZONyW3zNrnH2B7crjf8_7iz9jxhh8b8MQB6-8c_SkP3huVYcNIqFFCFShQQWl43F_2AVPdMy_TfnTiT7YAC-JpajCEReMHxby7rsQYDup85f5VEjtMYrGrw8U1&t=636899960260000000"></script><link id="Hxj_Web_UI_Css_jquery_css" href="/WebResource.axd?d=KAqzuM_1S7zjB7mwXE9DrE1FuyYvr72LmgdNPG-w9sUOtoMTidEttzJHErCRZnLGqN8-cEUwpdwFHrqh2R3GkyYvQGTtqbdQ7z6vg-_bUJWKXBX60&t=636899960260000000" rel="stylesheet" type="text/css"/><script language="javascript" id="Hxj_Web_UI_Script_hxj-jquery-1_0_0_js" type="text/javascript" src="/WebResource.axd?d=pGL4zAxN02HyoXuMxw6bT86q5RNF1QAiydkf3U2WgwVI1rd-DtzbIHSES2-AextlWdiPv1MYHRJWlApIdHxFfvnahZNs0R4r71HRogH_3osypEAqzavfdeGQ3_U1&t=636899960260000000"></script><link id="wulong.iconfont" href="https://at.alicdn.com/t/font_816790_nxi2aehu5gi.css" rel="stylesheet" type="text/css"/><script language="javascript" id="Hxj.Web.UI.ACall_CallPage" type="text/javascript" >var _Call_PostForm={};function _CallPage(method,oArgs){var oPostArg=oArgs;if(arguments.length>2){var oPostArg=new Array();for(var iAa1=1;iAa1<arguments.length;iAa1++){if(arguments[iAa1]==null){oPostArg.push(null);}else{oPostArg.push(arguments[iAa1].toString());}}};return $.call('ACall1',oPostArg,method,'{page}',null,true)}</script><script language="javascript" id="Hxj.Web.UI.ACall_AsyncCallPage" type="text/javascript" >function _AsyncCallPage(method,callBack,showWait,oArgs){var oPostArg=oArgs;if(arguments.length>4){var oPostArg=new Array();for(var iAa1=3;iAa1<arguments.length;iAa1++){if(arguments[iAa1]==null){oPostArg.push(null);}else{oPostArg.push(arguments[iAa1].toString());}}};return $.call('ACall1',oPostArg,method,'{page}',callBack,showWait)}; function _ACP(method,callBack,oArgs){var oPostArg=oArgs;if(arguments.length>2){var oPostArg=new Array();for(var iAa1=2;iAa1<arguments.length;iAa1++){if(arguments[iAa1]==null){oPostArg.push(null);}else{oPostArg.push(arguments[iAa1].toString());}}};return $.call('ACall1',oPostArg,method,'{page}',callBack,true)}</script>
<div class="aspNetHidden">

	<input type="hidden" name="__VIEWSTATEGENERATOR" id="__VIEWSTATEGENERATOR" value="55BE7C2D" />
</div>
        
<link href="/Style/float.css?t=2.2" rel="stylesheet" />
<script src="/Script/float.js?t=2.3" type="text/javascript"></script>
  <table cellpadding="0" cellspacing="0" id="float_top"  style="display:none;">
    <tr>
        <td style="padding-bottom:0px;vertical-align:middle;">
            <center>
                <table cellpadding="0" cellspacing="0" id="float_table">
                    <tr>
                        <td style="vertical-align:top;">
                         

                            <iframe id="float_frame" name="float_frame"  frameborder="0" class="_float_box" ></iframe>
                            <div class="_opacity"> </div>
                        </td>
                    </tr>
                </table>

            </center>
        </td>
    </tr>
</table>
        
<link href="/Style/msg.css?t=2.1" rel="stylesheet" />
<script src="/Script/msg.js?t=3.1" type="text/javascript"></script>
<table cellpadding="0" cellspacing="0" id="msg_top"
    style="display: none;">
    <tr>
        <td style="vertical-align:top;">

            <div class="_opacity"></div>

            <table cellpadding="0" cellspacing="0" id="msg_table">
                <tr>
                    <td style="vertical-align: middle;padding-bottom: 10%;">
                        <center style="padding-bottom:10px;">
                            <div id="msg_body" class="main_border _float_box" style="text-align: left;">
                                <div class="t_" id="msg_title">提示 !</div>
                                <div id="msg_text" style=""></div>
                                <div id="msg_btn_div">
                                    <a href="javascript:void(0)" onclick="_MsgHide()" id="msg_close" style="border:none;" class="btn_1 h28">关闭</a>
                                </div>
                            </div>
                        </center>

                        
                    </td>
                </tr>
            </table>



        </td>
    </tr>
</table>

        
<link href="/Style/Prompt.css?t=2.2" rel="stylesheet" />
<script src="/Script/Prompt.js?t=3.91" type="text/javascript"></script>

<table cellpadding="0" cellspacing="0" onclick="document.all.prompt_value.focus()" id="prompt_top"
    style="display: none;">
    <tr>
        <td style="vertical-align: top;">

            <div class="_opacity"></div>
            <table cellpadding="0" cellspacing="0" id="prompt_table">
                <tr>
                    <td style="vertical-align: middle;">
                        <center>
                             <div id="prompt_body" class="main_border _float_box">
                                 <div class="t_" id="prompt_title">提示...</div>
                               <div style="min-height:140px; ">
                                  <div style="padding:12px;">
                                     
                                    <div id="prompt_text"></div>
                                
                                     <input type="text"  id="prompt_value" value="" class="input_text" style="width:100%;height:26px;"/>
                                      
                                 </div>

                                 </div>

                                <div id="prompt_btn_div">
                                    <span id="prompt_confirm" class="btn_1 h28">
                                    确认</span>
                                    <span id="prompt_close" class="btn_4 h28">
                                    取消</span></div>
                            </div>


           
                                  </center>
                    </td>
                </tr>
            </table>



        </td>
    </tr>
</table>
<table cellpadding="0" cellspacing="0" onclick="document.all.prompt_value.focus()" id="xprompt_top"
    style="display: none;">
    <tr>
        <td style="vertical-align: top;">

            <div class="_opacity"></div>
            <table cellpadding="0" cellspacing="0" id="xprompt_table">
                <tr>
                    <td style="vertical-align: middle;">
                        <center>
                             <div id="xprompt_body" class="main_border _float_box">
                                 <div class="t_" id="xprompt_title">提示...</div>
                               <div style="min-height:140px; ">
                                  <div style="padding:12px;">
                                     
                                    <div id="xprompt_text" style="word-wrap: break-word;word-break: normal;"></div>
                                
                                     <textarea rows="5" cols="10" id="xprompt_value" class="input_text" style="width:100%;height:100px;overflow:auto;"></textarea>
                                      
                                 </div>

                                 </div>

                                <div id="xprompt_btn_div">
                                    <span id="xprompt_confirm" class="btn_1 h28">
                                    确认</span>
                                    <span id="xprompt_close" class="btn_4 h28">
                                    取消</span></div>
                            </div>


           
                                  </center>
                    </td>
                </tr>
            </table>



        </td>
    </tr>
</table>

        
<link href="/Style/confirm.css?t=2.2" rel="stylesheet" />
<script src="/script/confirm.js?t=3.3" type="text/javascript"></script>
<table cellpadding="0" cellspacing="0" id="confirm_top"
    style="display: none;">
    <tr>
        <td style="vertical-align: top;">

            <div class="_opacity"></div>
            <table cellpadding="0" cellspacing="0" id="confirm_table">
                <tr>
                    <td style="vertical-align: middle;">
                        <center>
                            <div id="confirm_body" class="main_border _float_box">
                                <div   class="t_" id="confirm_title">请确认 ? </div>

                                

                                    <div id="confirm_text"></div>

                             

                                <div id="confirm_btn_div">
                          
                                    <input type="button" id="confirm_confirm" class="btn_1 h28" tabindex="0" value="确认"/>
                                    <input type="button" id="confirm_close" class="btn_4 h28" tabindex="1" value="取消"/>
                                </div>
                            </div>
                        </center>

                        
                    </td>
                </tr>
            </table>



        </td>
    </tr>
</table>

        
        <div class="page-content home">
            <div class="page-bar">
                <div class="clearfix">
                    <div class="col-xs-8 padX0">
                        <div class="page-bar-inner">
                            <span>业务洞察</span>
                            <span class="point"></span>
                            <div class="dropdown custom">
                                <span class="dropdown-toggle" data-toggle="dropdown">整体业务洞察</span>
                                <a href="javascript:;" class="page-bar-link" onclick="window.open('http://erp321.com/app/support/document.html#cate=296')"><i class="icon iconfont icon-caozuoshuoming"></i><span>操作说明</span></a>
                            </div>
                        </div>
                    </div>
                    <label class="col-xs-4 padR0 tRight">
                        <span class="tips-info" style="">数据更新时间：<span id="statDate"></span></span>
                    </label>
                </div>
            </div>
            <div class="clearfix marT15">
                <div class="col-md-4 padX0">
                    <div class="shadow" style="padding: 1px 0 1px 1px;">
                        <table class="demo-table">
                            <thead>
                                <tr>
                                    <th colspan="3">平均复购周期</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr class="bdNone">
                                    <td>
                                        <div class="demo-data">
                                            <div><span id="cycle_3">0.0</span>天</div>
                                            <div>3个月内</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="demo-data">
                                            <div><span id="cycle_6">0.0</span>天</div>
                                            <div>6个月内</div>
                                        </div>
                                    </td>
                                    <td>
                                        <div class="demo-data" style="border-right-color: transparent;">
                                            <div><span id="cycle_12">0.0</span>天</div>
                                            <div>12个月内</div>
                                        </div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-md-8 padR0">
                    <div class="shadow" style="padding: 1px;">
                        <table class="demo-table">
                            <thead>
                                <tr>
                                    <th>时间统计</th>
                                    <th>首次购买人数</th>
                                    <th>复购人数</th>
                                    <th>首次购买客单价</th>
                                    <th>复购客单价</th>
                                </tr>
                            </thead>
                            <tbody id="salesStatData">
                                <tr>
                                    <td style="color: #bdcee1;">7天内</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0.00</td>
                                    <td>0.00</td>
                                </tr>
                                <tr>
                                    <td style="color: #bdcee1;">15天内</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0.00</td>
                                    <td>0.00</td>
                                </tr>
                                <tr class="bdNone">
                                    <td style="color: #bdcee1;">30天内</td>
                                    <td>0</td>
                                    <td>0</td>
                                    <td>0.00</td>
                                    <td>0.00</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="clearfix marT15">
                <div class="col-md-4 padX0">
                    <div class="shadow">
                        <div class="title-border">
                            客户分类
                        </div>
                        <div id="chartPie" style="height: 300px;"></div>
                    </div>
                </div>
                <div class="col-xs-8 padR0">
                    <div class="shadow" id="chart2" style="height: 348px;"></div>
                </div>
            </div>
            <div class="marT15 shadow">
                <div class="title-border">近30天购买商品排行</div>
                <div class="clearfix">
                    <div class="col-xs-4 padX0">
                        <div style="height: 300px;" id="chart3"></div>
                    </div>
                    <div class="col-xs-8 padX0">
                        <div style="height: 300px;" id="chart4"></div>
                    </div>
                </div>
            </div>
            <div class="shadow marT15">
                <div style="height: 400px;" id="chart6"></div>
            </div>
        </div>
    
<script language='javascript'>__Msg=_Msg</script></form>
    <img style="display:none;" src="http://crm.erp321.com/app/report/log/pageVisitLog.aspx?co_id=10037214&user_id=10144789&remark=%e8%82%b2%e5%ae%a2-%e6%95%b4%e4%bd%93%e4%b8%9a%e5%8a%a1%e6%b4%9e%e5%af%9f%e9%a1%b5" />
</body>
<script src="../../../script/CRM/common.js"></script>
<script src="../../report/dashboard/highcharts/js/new/highcharts.js"></script>
<script src="../../../script/wechat/bootstrap-2.3.2.min.js"></script>
<script src="/Script/Crm2c.js?t=1.001" type="text/javascript"></script>
<script src="home.js"></script>

<script>
    $(function () {

        //新版
        _AsyncCallPage("GetMaxDate", function (rv) {
            if (rv) {
                var statDate = rv.substring(0, 10).replace("-", ".").replace("-", ".");
                $("#statDate").text(statDate);
                GetBuycycleStat(rv);
                GetSalesByRangeStatStat(rv);
            }
        }, true);
        LoadData();
    });

    //读取平时复购周期
    function GetBuycycleStat(maxdate) {
        _AsyncCallPage("GetBuycycleStatData",
            function (rv) {
                if (rv) {
                    var result = JSON.parse(rv);
                    if (result.IsPass) {
                        var list = result.Obj;
                        for (var i = 0; i < list.length; i++) {
                            var month = list[i].Month;
                            var cycle = list[i].Cycle || 0.0;
                            if (month == 3) {
                                $("#cycle_3").html(cycle);
                            } else if (month == 6) {
                                $("#cycle_6").html(cycle);
                            } else {
                                $("#cycle_12").html(cycle);
                            }
                        }
                    }
                }
            }, true, maxdate);
    }

    //读取平时复购周期
    function GetSalesByRangeStatStat(maxdate) {
        _AsyncCallPage("GetSalesByRangeStatData",
            function (rv) {
                if (rv) {
                    var result = JSON.parse(rv);
                    var html = "";
                    if (result.IsPass) {
                        var list = result.Obj;
                        if (list.length > 0) {
                            $("#salesStatData").empty();
                            for (var i = 0; i < list.length; i++) {
                                html += '<tr>\
                                     <td style= "color: #bdcee1;" > '+ list[i].Day + '天内</td >\
                                     <td>'+ (list[i].BuyCntFirst || 0).toLocaleString('en-US') + '</td>\
                                    <td>'+ (list[i].BuyCntMore || 0).toLocaleString('en-US') + '</td>\
                                    <td>'+ (list[i].AvgPayOrderAmountFirst || 0).toFixed(2) + '</td>\
                                    <td>'+ (list[i].AvgPayOrderAmountMore || 0).toFixed(2) + '</td>\
                                </tr >';
                            }
                            $("#salesStatData").append(html);
                        }
                    }
                }
            }, true, maxdate);
    }

    function LoadData() {

        _AsyncCallPage("LoadData",
            function (rv) {
                if (rv) {
                    var data = JSON.parse(rv);
                    if (data != null) {
                        showData(data);
                    }

                }
            }, true);

    }

    function showData(data) {

        //highcharts 无刻度曲线        
        data7.dataX = data.DailyStatDateList;
        data7.dataY[0].data = data.DailyStatPayOrderAmountList;
        chartCurve("chart7", data7);

        data8.dataX = data.DailyStatDateList;
        data8.dataY[0].data = data.DailyStatPayOrderAvgAmountList;
        chartCurve("chart8", data8);

        data9.dataX = data.DailyStatDateList;
        data9.dataY[0].data = data.DailyStatPayOrderAvgCountList;
        chartCurve("chart9", data9);

        data10.dataX = data.DailyStatDateList;
        data10.dataY[0].data = data.DailyStatRetentionRateList;
        chartCurve("chart10", data10);

        data11.dataX = data.DailyStatDateList;
        data11.dataY[0].data = data.DailyStatLostRateList;
        chartCurve("chart11", data11);


        //客户分类
        var valueArray = new Array;
        var highValueData = { 'name': '高价值', 'y': data.HighValueCount, 'color': '#ff7700' };
        var middleValueData = { 'name': '中价值', 'y': data.MiddleValueCount, 'color': '#ffb10a' };
        var lowValueData = { 'name': '低价值', 'y': data.LowValueCount, 'color': '#ffe414' };
        valueArray.push(highValueData);
        valueArray.push(middleValueData);
        valueArray.push(lowValueData);
        pieData.dataY = valueArray;

        chartPie("chartPie", pieData);

        //近30天会员转化
        data2.dataX = data.DailyStatDateList;
        data2.dataY[0].data = data.DailyStatNewBuyerIncreaseList;
        data2.dataY[1].data = data.DailyStatOldBuyerIncreaseList;
        chartLine('chart2', data2);


        ////购买商品排行三个表
        if (data.NewItemCountList && data.NewItemCountList.length > 0) {
            var tempDataArray = new Array;
            for (var i = 0; i < data.NewItemCountList.length; i++) {
                var item = data.NewItemCountList[i];
                var tempData = { name: item.ItemName, y: item.Qty30day, color: '#4aa8f6' };
                tempDataArray.push(tempData);
            }
            data3.dataY[0].data = tempDataArray;
        }

        chartBar('chart3', data3);

        if (data.OldItemCountList && data.OldItemCountList.length > 0) {
            var tempDataArray = new Array;
            for (var i = 0; i < data.OldItemCountList.length; i++) {
                var item = data.OldItemCountList[i];
                var tempData = { name: item.ItemName, y: item.Qty30day, color: '#fdae20' };
                tempDataArray.push(tempData);
            }
            data4.dataY[0].data = tempDataArray;
        }
        chartBar('chart4', data4);

        ////消费贡献表
        data6.dataX = data.LoyaltyStatDateList;
        data6.dataY[0].data = data.NewLoyaltyAmountList;
        data6.dataY[1].data = data.OldLoyaltyAmountList;
        data6.dataY[0].color = '#4aa8f6';
        data6.dataY[1].color = '#fdae20';
        data6.dataY[0].tooltip.valueSuffix = '元';
        data6.dataY[1].tooltip.valueSuffix = '元';
        chartLine('chart6', data6);
    }

</script>
</html>
